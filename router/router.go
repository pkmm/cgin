package router

import (
	"cgin/conf"
	_ "cgin/docs" // docs is generated by Swag CLI, you have to import it.
	"cgin/middleware"
	"github.com/gin-contrib/gzip"
	"github.com/gin-gonic/gin"
	swaggerFiles "github.com/swaggo/files"
	ginSwagger "github.com/swaggo/gin-swagger"
)

const (
	Version = "v1"

	RootApiPrefix = "/api/" + Version
	AuthPrefix    = RootApiPrefix + "/auth"
	Student       = RootApiPrefix + "/students"
	MiniProgram   = RootApiPrefix + "/mini_program"
	Trigger       = RootApiPrefix + "/trigger/"
	Thinking      = RootApiPrefix + "/thinking"
	Score         = RootApiPrefix + "/scores"
)

func MapRoute() *gin.Engine {

	router := gin.New()
	// 全局的中间件
	router.Use(gzip.Gzip(gzip.DefaultCompression), middleware.BusinessErrorHandler())

	// dev export swagger api.
	if conf.AppEnvDev == conf.AppConfig.DefaultString(conf.AppEnvironment, conf.AppEnvProd) {
		router.GET("/swagger/*any", ginSwagger.DisablingWrapHandler(swaggerFiles.Handler, "xx"))
	}

	mapNormalRouter(router)
	mapStudentRouter(router)
	mapStaticRouter(router)
	mapMiniProgramRouter(router)
	mapTaskRouter(router)
	mapThinkingRouter(router)
	mapScoresRouter(router)
	mapAuthRouter(router)

	return router
}
